 <!-- templates/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Audio Recorder</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <style>
        img {
            max-width: 300px;
            max-height: 300px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <form action="/submit" method="post" target="hiddenFrame">
       
    <input type="file" id="uploadInput" accept="image/*">
    <div id="imageContainer"></div>

    </form>

<p id="caption"></p>
<p id="text"></p>
<p id="nlp"></p>

<button id="alt-btn" >Alt Translate</button>

    <audio controls id="audioElement">
        Your browser does not support the audio element.
    </audio>


    <script>
        const uploadImage = document.getElementById('uploadInput');
        uploadInput.addEventListener('change', handleImageUpload);
        
        let currentImage;  // Add this variable

        function handleImageUpload(event) {
            
            const file = event.target.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                const image = new Image();
                image.src = e.target.result;

                // Remove the existing image before adding the new one
                if (currentImage) {
                    imageContainer.removeChild(currentImage);
                }

                currentImage = image;
                imageContainer.appendChild(image);
            };

            reader.readAsDataURL(file);

            const formData = new FormData();
            formData.append('image', file);
            fetch('/image_processing', {
                method: 'POST',
                body: formData  
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                document.getElementById("caption").innerHTML = "Caption: " + data['caption']
                document.getElementById("text").innerHTML = "Text: " 
                for (var i = 0; i < data.text.length; i++ ) {
                    document.getElementById("text").innerHTML = document.getElementById("text").innerHTML + "<br>" + data['text'][i];
                }
				// ==================================
				fetch('/nlp_processing', {
					method: 'POST'  
				})
				.then(response => response.json())
				.then(data => {
					console.log(data)
					for (var i = 0; i < data.nlp_result.length; i++ ) {
						document.getElementById("nlp").innerHTML = document.getElementById("nlp").innerHTML + "<br>" + data['nlp_result'][i];
					}
				})

				.catch(error => {
					console.error('Error:', error);
				});
				// ==================================
            })

            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while uploading the image.');
            });



        }
    </script>


    <script>
		var altBtn = document.getElementById('alt-btn');
        altBtn.onclick = function () {
        var formData = new FormData();
        formData.append('name', 'Bob');
        fetch('/speech_processing', { method: 'POST', body: formData })
            .then(function (response) {
                console.log(response);
            fetch('/get_wav_file')
                .then(response => response.blob())
                .then(blob => {
                    const audioURL= URL.createObjectURL(blob)
                    const audio = new Audio(audioURL);
                    audio.play();
                    audioElement.src = audioURL; 
                })
                .catch(error => {
                    console.error('Error:', error);
                });

            })
        };
    </script>
 </body>
</html>
